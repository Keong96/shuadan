<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>控制面板</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <style>
    body {
    margin: 0;
    padding-top: 56px;
    font-family: system-ui, sans-serif;
    background-color: #1e1e2f;
    color: #f0f0f0;
  }

  .navbar {
    background-color: #27293d;
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 1000;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }

  .navbar-brand {
    color: #f0f0f0;
  }

  .navbar-toggler {
    border-color: rgba(255, 255, 255, 0.4);
  }

  .navbar-toggler-icon {
    filter: invert(1);
  }

  .wrapper {
    display: flex;
    flex-direction: column;
  }

  @media (min-width: 992px) {
    .wrapper {
      flex-direction: row;
    }
  }

  .sidebar {
    background-color: #2c2f48;
    border-bottom: 1px solid #333;
  }

  @media (min-width: 992px) {
    .sidebar {
      position: sticky;
      top: 56px;
      height: calc(100vh - 56px);
      width: 250px;
      border-right: 1px solid #333;
      overflow-y: auto;
    }
  }

  .sidebar .nav-link {
    color: #ccc;
    margin: 0.5rem 0;
  }

  .sidebar .nav-link.active,
  .sidebar .nav-link:hover {
    background-color: #3e4161;
    color: #fff;
    border-radius: 5px;
  }

  .main-content {
    flex-grow: 1;
    padding: 20px;
    background-color: #1e1e2f;
  }

  .card {
    background-color: #2a2d45;
    border: none;
    color: #fff;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .chart-container {
    background-color: #2a2d45;
    border-radius: 10px;
    padding: 1rem;
  }

  .btn-primary {
    background-color: #4e54c8;
    border-color: #4e54c8;
  }

  .btn-primary:hover {
    background-color: #3b40a4;
    border-color: #3b40a4;
  }

  .stat-card h6 {
    font-size: 0.9rem;
    color: #aaa;
  }

  .stat-card h4 {
    margin-top: 0.25rem;
    font-weight: 600;
    color: #fff;
  }

  .table thead {
    background-color: #3e4161;
  }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg px-4">
    <a class="navbar-brand text-white" href="index.html">控制面板</a>
    <button
      class="navbar-toggler ms-auto"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#sidebarMenu"
      aria-controls="sidebarMenu"
      aria-expanded="false"
      aria-label="Toggle sidebar"
      id="sidebarToggle"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
  </nav>

  <div class="wrapper">
    <div class="sidebar collapse d-lg-block" id="sidebarMenu">
      <nav class="nav flex-column px-3 pt-4">
        <a class="nav-link active" href="admin-dashboard.html"><i class="bi bi-speedometer2 me-2"></i>控制面板</a>
        <a class="nav-link" href="/admin-user.html"><i class="bi bi-people me-2"></i>用户管理</a>
        <a class="nav-link" href="/admin-task.html"><i class="bi bi-box-seam me-2"></i>产品管理</a>
        <a class="nav-link" href="/admin-transaction.html"><i class="bi bi-bank me-2"></i>交易明细</a>
        <a class="nav-link" href="/admin-setting.html"><i class="bi bi-receipt me-2"></i>全局设定</a>
        <a class="nav-link" href="#" onclick="Logout()"><i class="bi bi-box-arrow-right me-2"></i>登出</a>
      </nav>
    </div>

    <div class="main-content">
      <div class="container-fluid">
        <div class="row mb-4">
          <div class="col-12 col-md-6 col-lg-3 mb-3">
            <div class="card stat-card p-3">
              <h6>用户数量</h6>
              <h4>1,254</h4>
            </div>
          </div>
          <div class="col-12 col-md-6 col-lg-3 mb-3">
            <div class="card stat-card p-3">
              <h6>订单数量</h6>
              <h4>428</h4>
            </div>
          </div>
          <div class="col-12 col-md-6 col-lg-3 mb-3">
            <div class="card stat-card p-3">
              <h6>交易总数</h6>
              <h4>$89,300</h4>
            </div>
          </div>
          <div class="col-12 col-md-6 col-lg-3 mb-3">
            <div class="card stat-card p-3">
              <h6>提成总数</h6>
              <h4>$7,520</h4>
            </div>
          </div>
        </div>
      
        <div class="row">
          <div class="col-12 mb-4">
            <div class="card chart-container">
              <canvas id="userGrowthChart" height="120"></canvas>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-12 mb-4">
            <div class="card chart-container">
              <canvas id="transactionGrowthChart" height="240"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>

    const token = localStorage.getItem("token");
    if(!token)
    {
      window.stop();
      window.location.href = `${window.location.origin}/index.html`;
    }

    const decoded_token = jwt_decode(token);
    if (decoded_token.exp < Math.floor(Date.now()/1000) || decoded_token.userType !== 0)
    {
      window.stop();
      localStorage.removeItem("token");
      window.location.href = `${window.location.origin}/index.html`;
    }

    const userGrowthChart = document.getElementById('userGrowthChart').getContext('2d');
    new Chart(userGrowthChart, {
      type: 'line',
      data: {
        labels: ['三月', '四月', '五月', '六月', '七月', '八月'],
        datasets: [{
          label: '用户增长',
          data: [200, 400, 650, 900, 1200, 1254],
          fill: true,
          backgroundColor: 'rgba(78, 84, 200, 0.2)',
          borderColor: '#4e54c8',
          tension: 0.4
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            ticks: { color: '#ccc' },
            grid: { color: '#333' }
          },
          y: {
            ticks: { color: '#ccc' },
            grid: { color: '#333' }
          }
        },
        plugins: {
          legend: {
            labels: { color: '#ccc' }
          }
        }
      }
    });

    const transactionGrowthChart = document.getElementById('transactionGrowthChart').getContext('2d');
    new Chart(transactionGrowthChart, {
      type: 'bar',
      data: {
        labels: ['三月', '四月', '五月', '六月', '七月', '八月'],
        datasets: [{
          label: '资金走势',
          data: [200, 400, 650, 900, 1200, 1254],
          fill: false,
          // backgroundColor: 'rgba(78, 84, 200, 0.2)',
          // borderColor: '#4e54c8',
          tension: 0.4
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            ticks: { color: '#ccc' },
            grid: { color: '#333' }
          },
          y: {
            ticks: { color: '#ccc' },
            grid: { color: '#333' }
          }
        },
        plugins: {
          legend: {
            labels: { color: '#ccc' }
          }
        }
      }
    });
    
    document.getElementById('sidebarToggle').addEventListener('click', function() {window.scrollTo(0, 0);});

    function Logout() {
      localStorage.removeItem("token");
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
